/* ===========================
   BULLETPROOF RAW SCHEMA
   - IDs as NVARCHAR(36)
   - Dates as NVARCHAR(50)
   - Numbers as NVARCHAR(50)
   - Text as NVARCHAR(4000)
   =========================== */

IF NOT EXISTS (SELECT 1 FROM sys.schemas WHERE name = 'raw')
    EXEC('CREATE SCHEMA raw');
GO

/* ===== allergies.csv ===== */
DROP TABLE IF EXISTS raw.allergies;
GO
CREATE TABLE raw.allergies (
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    SYSTEM NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    TYPE NVARCHAR(4000) NULL,
    CATEGORY NVARCHAR(4000) NULL,
    REACTION1 NVARCHAR(4000) NULL,
    DESCRIPTION1 NVARCHAR(4000) NULL,
    SEVERITY1 NVARCHAR(4000) NULL,
    REACTION2 NVARCHAR(4000) NULL,
    DESCRIPTION2 NVARCHAR(4000) NULL,
    SEVERITY2 NVARCHAR(4000) NULL
);
GO

/* ===== careplans.csv ===== */
DROP TABLE IF EXISTS raw.careplans;
GO
CREATE TABLE raw.careplans (
    Id NVARCHAR(36) NULL,
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    REASONCODE NVARCHAR(4000) NULL,
    REASONDESCRIPTION NVARCHAR(4000) NULL
);
GO

/* ===== claims.csv ===== */
DROP TABLE IF EXISTS raw.claims;
GO
CREATE TABLE raw.claims (
    Id NVARCHAR(36) NULL,
    PATIENTID NVARCHAR(36) NULL,
    PROVIDERID NVARCHAR(36) NULL,
    PRIMARYPATIENTINSURANCEID NVARCHAR(36) NULL,
    SECONDARYPATIENTINSURANCEID NVARCHAR(36) NULL,
    DEPARTMENTID NVARCHAR(4000) NULL,
    PATIENTDEPARTMENTID NVARCHAR(4000) NULL,
    DIAGNOSIS1 NVARCHAR(4000) NULL,
    DIAGNOSIS2 NVARCHAR(4000) NULL,
    DIAGNOSIS3 NVARCHAR(4000) NULL,
    DIAGNOSIS4 NVARCHAR(4000) NULL,
    DIAGNOSIS5 NVARCHAR(4000) NULL,
    DIAGNOSIS6 NVARCHAR(4000) NULL,
    DIAGNOSIS7 NVARCHAR(4000) NULL,
    DIAGNOSIS8 NVARCHAR(4000) NULL,
    REFERRINGPROVIDERID NVARCHAR(4000) NULL,
    APPOINTMENTID NVARCHAR(4000) NULL,
    CURRENTILLNESSDATE NVARCHAR(50) NULL,
    SERVICEDATE NVARCHAR(50) NULL,
    SUPERVISINGPROVIDERID NVARCHAR(4000) NULL,
    STATUS1 NVARCHAR(4000) NULL,
    STATUS2 NVARCHAR(4000) NULL,
    STATUSP NVARCHAR(50) NULL,
    OUTSTANDING1 NVARCHAR(50) NULL,
    OUTSTANDING2 NVARCHAR(50) NULL,
    OUTSTANDINGP NVARCHAR(50) NULL,
    LASTBILLEDDATE1 NVARCHAR(50) NULL,
    LASTBILLEDDATE2 NVARCHAR(50) NULL,
    LASTBILLEDDATEP NVARCHAR(50) NULL,
    HEALTHCARECLAIMTYPEID1 NVARCHAR(4000) NULL,
    HEALTHCARECLAIMTYPEID2 NVARCHAR(4000) NULL
);
GO

/* ===== claims_transactions.csv ===== */
DROP TABLE IF EXISTS raw.claims_transactions;
GO
CREATE TABLE raw.claims_transactions (
    ID NVARCHAR(36) NULL,
    CLAIMID NVARCHAR(36) NULL,
    CHARGEID NVARCHAR(4000) NULL,
    PATIENTID NVARCHAR(36) NULL,
    TYPE NVARCHAR(4000) NULL,
    AMOUNT NVARCHAR(50) NULL,
    METHOD NVARCHAR(4000) NULL,
    FROMDATE NVARCHAR(50) NULL,
    TODATE NVARCHAR(50) NULL,
    PLACEOFSERVICE NVARCHAR(4000) NULL,
    PROCEDURECODE NVARCHAR(4000) NULL,
    MODIFIER1 NVARCHAR(4000) NULL,
    MODIFIER2 NVARCHAR(4000) NULL,
    DIAGNOSISREF1 NVARCHAR(4000) NULL,
    DIAGNOSISREF2 NVARCHAR(4000) NULL,
    DIAGNOSISREF3 NVARCHAR(4000) NULL,
    DIAGNOSISREF4 NVARCHAR(4000) NULL,
    UNITS NVARCHAR(50) NULL,
    DEPARTMENTID NVARCHAR(4000) NULL,
    NOTES NVARCHAR(4000) NULL,
    UNITAMOUNT NVARCHAR(50) NULL,
    TRANSFEROUTID NVARCHAR(4000) NULL,
    TRANSFERTYPE NVARCHAR(4000) NULL,
    PAYMENTS NVARCHAR(50) NULL,
    ADJUSTMENTS NVARCHAR(50) NULL,
    TRANSFERS NVARCHAR(50) NULL,
    OUTSTANDING NVARCHAR(50) NULL,
    APPOINTMENTID NVARCHAR(4000) NULL,
    LINENOTE NVARCHAR(4000) NULL,
    PATIENTINSURANCEID NVARCHAR(36) NULL,
    FEESCHEDULEID NVARCHAR(4000) NULL,
    PROVIDERID NVARCHAR(36) NULL,
    SUPERVISINGPROVIDERID NVARCHAR(36) NULL
);
GO

/* ===== conditions.csv ===== */
DROP TABLE IF EXISTS raw.conditions;
GO
CREATE TABLE raw.conditions (
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL
);
GO

/* ===== devices.csv ===== */
DROP TABLE IF EXISTS raw.devices;
GO
CREATE TABLE raw.devices (
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    UDI NVARCHAR(4000) NULL
);
GO

/* ===== encounters.csv ===== */
DROP TABLE IF EXISTS raw.encounters;
GO
CREATE TABLE raw.encounters (
    Id NVARCHAR(36) NULL,
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ORGANIZATION NVARCHAR(36) NULL,
    PROVIDER NVARCHAR(36) NULL,
    PAYER NVARCHAR(36) NULL,
    ENCOUNTERCLASS NVARCHAR(4000) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    BASE_ENCOUNTER_COST NVARCHAR(50) NULL,
    TOTAL_CLAIM_COST NVARCHAR(50) NULL,
    PAYER_COVERAGE NVARCHAR(50) NULL,
    REASONCODE NVARCHAR(4000) NULL,
    REASONDESCRIPTION NVARCHAR(4000) NULL
);
GO

/* ===== imaging_studies.csv ===== */
DROP TABLE IF EXISTS raw.imaging_studies;
GO
CREATE TABLE raw.imaging_studies (
    Id NVARCHAR(36) NULL,
    DATE NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    SERIES_UID NVARCHAR(4000) NULL,
    BODYSITE_CODE NVARCHAR(4000) NULL,
    BODYSITE_DESCRIPTION NVARCHAR(4000) NULL,
    MODALITY_CODE NVARCHAR(4000) NULL,
    MODALITY_DESCRIPTION NVARCHAR(4000) NULL,
    INSTANCE_UID NVARCHAR(4000) NULL,
    SOP_CODE NVARCHAR(4000) NULL,
    SOP_DESCRIPTION NVARCHAR(4000) NULL,
    PROCEDURE_CODE NVARCHAR(4000) NULL
);
GO

/* ===== immunizations.csv ===== */
DROP TABLE IF EXISTS raw.immunizations;
GO
CREATE TABLE raw.immunizations (
    DATE NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    BASE_COST NVARCHAR(50) NULL
);
GO

/* ===== medications.csv ===== */
DROP TABLE IF EXISTS raw.medications;
GO
CREATE TABLE raw.medications (
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    PAYER NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    BASE_COST NVARCHAR(50) NULL,
    PAYER_COVERAGE NVARCHAR(50) NULL,
    DISPENSES NVARCHAR(50) NULL,
    TOTALCOST NVARCHAR(50) NULL,
    REASONCODE NVARCHAR(4000) NULL,
    REASONDESCRIPTION NVARCHAR(4000) NULL
);
GO

/* ===== observations.csv ===== */
DROP TABLE IF EXISTS raw.observations;
GO
CREATE TABLE raw.observations (
    DATE NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CATEGORY NVARCHAR(4000) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    VALUE NVARCHAR(4000) NULL,
    UNITS NVARCHAR(4000) NULL,
    TYPE NVARCHAR(4000) NULL
);
GO

/* ===== organizations.csv ===== */
DROP TABLE IF EXISTS raw.organizations;
GO
CREATE TABLE raw.organizations (
    Id NVARCHAR(36) NULL,
    NAME NVARCHAR(4000) NULL,
    ADDRESS NVARCHAR(4000) NULL,
    CITY NVARCHAR(4000) NULL,
    STATE NVARCHAR(4000) NULL,
    ZIP NVARCHAR(4000) NULL,
    LAT NVARCHAR(50) NULL,
    LON NVARCHAR(50) NULL,
    PHONE NVARCHAR(4000) NULL,
    REVENUE NVARCHAR(50) NULL,
    UTILIZATION NVARCHAR(50) NULL
);
GO

/* ===== patients.csv ===== */
DROP TABLE IF EXISTS raw.patients;
GO
CREATE TABLE raw.patients (
    Id NVARCHAR(36) NULL,
    BIRTHDATE NVARCHAR(50) NULL,
    DEATHDATE NVARCHAR(50) NULL,
    SSN NVARCHAR(4000) NULL,
    DRIVERS NVARCHAR(4000) NULL,
    PASSPORT NVARCHAR(4000) NULL,
    PREFIX NVARCHAR(4000) NULL,
    FIRST NVARCHAR(4000) NULL,
    LAST NVARCHAR(4000) NULL,
    SUFFIX NVARCHAR(4000) NULL,
    MAIDEN NVARCHAR(4000) NULL,
    MARITAL NVARCHAR(4000) NULL,
    RACE NVARCHAR(4000) NULL,
    ETHNICITY NVARCHAR(4000) NULL,
    GENDER NVARCHAR(4000) NULL,
    BIRTHPLACE NVARCHAR(4000) NULL,
    ADDRESS NVARCHAR(4000) NULL,
    CITY NVARCHAR(4000) NULL,
    STATE NVARCHAR(4000) NULL,
    COUNTY NVARCHAR(4000) NULL,
    ZIP NVARCHAR(4000) NULL,
    LAT NVARCHAR(50) NULL,
    LON NVARCHAR(50) NULL,
    HEALTHCARE_EXPENSES NVARCHAR(50) NULL,
    HEALTHCARE_COVERAGE NVARCHAR(50) NULL
);
GO

/* ===== payer_transitions.csv ===== */
DROP TABLE IF EXISTS raw.payer_transitions;
GO
CREATE TABLE raw.payer_transitions (
    PATIENT NVARCHAR(36) NULL,
    MEMBERID NVARCHAR(4000) NULL,
    START_YEAR NVARCHAR(50) NULL,
    END_YEAR NVARCHAR(50) NULL,
    PAYER NVARCHAR(36) NULL,
    SECONDARY_PAYER NVARCHAR(36) NULL,
    OWNERSHIP NVARCHAR(4000) NULL,
    OWNERNAME NVARCHAR(4000) NULL
);
GO

/* ===== payers.csv ===== */
DROP TABLE IF EXISTS raw.payers;
GO
CREATE TABLE raw.payers (
    Id NVARCHAR(36) NULL,
    NAME NVARCHAR(4000) NULL,
    ADDRESS NVARCHAR(4000) NULL,
    CITY NVARCHAR(4000) NULL,
    STATE_HEADQUARTERED NVARCHAR(4000) NULL,
    ZIP NVARCHAR(4000) NULL,
    PHONE NVARCHAR(4000) NULL,
    AMOUNT_COVERED NVARCHAR(50) NULL,
    AMOUNT_UNCOVERED NVARCHAR(50) NULL,
    REVENUE NVARCHAR(50) NULL,
    COVERED_ENCOUNTERS NVARCHAR(50) NULL,
    UNCOVERED_ENCOUNTERS NVARCHAR(50) NULL,
    COVERED_MEDICATIONS NVARCHAR(50) NULL,
    UNCOVERED_MEDICATIONS NVARCHAR(50) NULL,
    COVERED_PROCEDURES NVARCHAR(50) NULL,
    UNCOVERED_PROCEDURES NVARCHAR(50) NULL,
    COVERED_IMMUNIZATIONS NVARCHAR(50) NULL,
    UNCOVERED_IMMUNIZATIONS NVARCHAR(50) NULL,
    UNIQUE_CUSTOMERS NVARCHAR(50) NULL,
    QOLS_AVG NVARCHAR(50) NULL,
    MEMBER_MONTHS NVARCHAR(50) NULL
);
GO

/* ===== procedures.csv ===== */
DROP TABLE IF EXISTS raw.procedures;
GO
CREATE TABLE raw.procedures (
    START NVARCHAR(50) NULL,
    STOP NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    BASE_COST NVARCHAR(50) NULL,
    REASONCODE NVARCHAR(4000) NULL,
    REASONDESCRIPTION NVARCHAR(4000) NULL
);
GO

/* ===== providers.csv ===== */
DROP TABLE IF EXISTS raw.providers;
GO
CREATE TABLE raw.providers (
    Id NVARCHAR(36) NULL,
    ORGANIZATION NVARCHAR(36) NULL,
    NAME NVARCHAR(4000) NULL,
    GENDER NVARCHAR(4000) NULL,
    SPECIALITY NVARCHAR(4000) NULL,
    ADDRESS NVARCHAR(4000) NULL,
    CITY NVARCHAR(4000) NULL,
    STATE NVARCHAR(4000) NULL,
    ZIP NVARCHAR(4000) NULL,
    LAT NVARCHAR(50) NULL,
    LON NVARCHAR(50) NULL,
    UTILIZATION NVARCHAR(50) NULL
);
GO

/* ===== supplies.csv ===== */
DROP TABLE IF EXISTS raw.supplies;
GO
CREATE TABLE raw.supplies (
    DATE NVARCHAR(50) NULL,
    PATIENT NVARCHAR(36) NULL,
    ENCOUNTER NVARCHAR(36) NULL,
    CODE NVARCHAR(4000) NULL,
    DESCRIPTION NVARCHAR(4000) NULL,
    QUANTITY NVARCHAR(50) NULL
);
GO



-- IDENTIFY COLUMNS IN A TABLE
SELECT 
  COLUMN_NAME,
  DATA_TYPE,
  CHARACTER_MAXIMUM_LENGTH
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'raw'
  AND TABLE_NAME = 'allergies'
ORDER BY ORDINAL_POSITION;
